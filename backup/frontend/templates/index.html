<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <!-- –î–æ–±–∞–≤–ª—è–µ–º –∏–º–ø–æ—Ä—Ç —à—Ä–∏—Ñ—Ç–∞ Montserrat -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">
  <!-- –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∏–ª–∏ –∑–∞—Ä–∞–Ω–µ–µ -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin="" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
  <link rel="stylesheet" href="/static/css/styles.css">
  
  <!-- –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è -->
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>
  <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.min.js"></script>
</head>
<body>
  <div class="container">
    <!-- –í–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å —à–∞–ø–∫–∏ (–ª–æ–≥–æ—Ç–∏–ø) -->
    <header class="header">
        <div class="logo">
            <!-- <span>üöö</span> –£–±—Ä–∞–ª–∏ –∏–∫–æ–Ω–∫—É -->
            <span>–¢–†–ê–ï–ö–¢–û–†–ò–Ø</span> <!-- –ò–∑–º–µ–Ω–∏–ª–∏ —Ç–µ–∫—Å—Ç -->
        </div>
    </header>

    <!-- –ù–æ–≤–∞—è —à–∞–ø–∫–∞-–ø–∞–Ω–µ–ª—å -->
    <div class="step-panel-container">
        <!-- –®–∞–≥ 1 -->
        <div class="step-panel active" data-step="1"> <!-- –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ - –®–∞–≥ 1 –∞–∫—Ç–∏–≤–µ–Ω -->
            <div class="step-panel-header">
                <span class="step-panel-icon">1</span>
                <span class="step-panel-title">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞</span>
            </div>
            <div class="step-panel-status"></div>
        </div>
        <!-- –®–∞–≥ 2 -->
        <div class="step-panel upcoming" data-step="2">
            <div class="step-panel-header">
                <span class="step-panel-icon">2</span>
                <span class="step-panel-title">–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥—Ä–µ—Å–æ–≤</span>
            </div>
        </div>
        <!-- –®–∞–≥ 3 -->
        <div class="step-panel upcoming" data-step="3">
            <div class="step-panel-header">
                <span class="step-panel-icon">3</span>
                <span class="step-panel-title">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</span>
            </div>
        </div>
    </div>
    <!-- –ö–æ–Ω–µ—Ü –Ω–æ–≤–æ–π —à–∞–ø–∫–∏ -->

    <!-- –û–≤–µ—Ä–ª–µ–π –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="loading" class="hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.8); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000;">
      <div class="spinner"></div>
      <p id="loading-message" style="margin-top: 16px; font-weight: 500;">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—à–∏–±–æ–∫ -->
    <div id="error-container" class="hidden">
      <span id="error-message">–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞.</span>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ü–û–°–¢–û–Ø–ù–ù–û–ì–û –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ—à–∏–±–∫–∏ -->
    <div id="persistent-error-log" 
         style="margin-top: 15px; padding: 10px; border: 1px solid red; background-color: #ffeeee; color: red; font-family: monospace; white-space: pre-wrap; display: none;">
      –ü–æ—Å–ª–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞:
    </div>

    <!-- –®–∞–≥ 1: –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ -->
    <div id="step-1-content" class="step-content">
      <div class="card">
        <h2>–ó–∞–≥—Ä—É–∑–∏—Ç–µ Excel-—Ñ–∞–π–ª —Å –º–∞—Ä—à—Ä—É—Ç–∞–º–∏</h2>
        <p style="margin-bottom: 20px; color: #666;">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª –≤ –æ–±–ª–∞—Å—Ç—å –Ω–∏–∂–µ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞ —Å –≤–∞—à–µ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞.</p>
        
        <div id="upload-area" class="upload-area">
          <div class="upload-icon">üìÑ</div>
          <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª Excel (.xlsx) –∏–ª–∏ –∫–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</p>
          <input type="file" id="file-input" accept=".xlsx, .xls" style="display: none;">
        </div>

        <!-- –ü–æ–ª–µ: –í—Ä–µ–º—è –Ω–∞ —Ç–æ—á–∫—É (–º–∏–Ω) -->
        <div class="input-group" style="margin-top: 25px; margin-bottom: 20px;">
            <label for="service-time-input" class="input-label">–í—Ä–µ–º—è –Ω–∞ —Ç–æ—á–∫—É (–º–∏–Ω):</label>
            <input type="number" id="service-time-input" name="service_time_per_stop_minutes" class="input time-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤—Ä–µ–º—è" value="0" min="0">
        </div>
        <!-- –ö–æ–Ω–µ—Ü –ø–æ–ª—è -->

        <div id="upload-success" class="hidden" style="margin-top: 20px; padding: 12px; background-color: rgba(40, 167, 69, 0.1); border: 1px solid #28a745; border-radius: 8px;">
          <div style="display: flex; align-items: center; gap: 12px;">
            <span style="color: #28a745; font-size: 24px;">‚úÖ</span>
            <div>
              <h3 style="margin: 0; color: #28a745;">–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω</h3>
              <p style="margin: 8px 0 0 0;">–ò–º—è —Ñ–∞–π–ª–∞: <span id="uploaded-filename"></span></p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥—Ä–µ—Å–æ–≤ -->
    <div id="step-2-content" class="step-content hidden">
      <div class="card">
        <h2>–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥—Ä–µ—Å–æ–≤</h2>
        <p style="margin-bottom: 20px; color: #666;">–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∞–¥—Ä–µ—Å–∞ —Ç—Ä–µ–±—É—é—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏. –í—ã –º–æ–∂–µ—Ç–µ –≤–Ω–µ—Å—Ç–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∏–∂–µ.</p>
        
        <div id="exceptions-container" class="hidden">
          <form id="corrections-form">
            <table class="table">
              <thead>
                <tr>
                  <th>–ú–∞—Ä—à—Ä—É—Ç</th>
                  <th>–ê–¥—Ä–µ—Å</th>
                  <th>–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∞–¥—Ä–µ—Å</th>
                </tr>
              </thead>
              <tbody id="exceptions-table"></tbody>
            </table>
            
            <div class="buttons-container">
              <button type="button" class="btn btn-outline" data-step="1">–ù–∞–∑–∞–¥</button>
              <button type="submit" class="btn">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
            </div>
          </form>
        </div>

        <div id="correction-success" class="hidden" style="margin-top: 20px; padding: 12px; background-color: rgba(40, 167, 69, 0.1); border: 1px solid #28a745; border-radius: 8px;">
          <div style="display: flex; align-items: center; gap: 12px;">
            <span style="color: #28a745; font-size: 24px;">‚úÖ</span>
            <div>
              <h3 style="margin: 0; color: #28a745;">–ê–¥—Ä–µ—Å–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã</h3>
              <p style="margin: 8px 0 0 0;">–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∞–¥—Ä–µ—Å–æ–≤: <span id="correction-count">0</span></p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- –®–∞–≥ 3: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
    <div id="step-3-content" class="step-content hidden">
      <div class="card">
        <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–∞—Ä—à—Ä—É—Ç–∞</h2>
        
        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–∞—Ä—Ç—ã - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Ä—Ç—É –ø–µ—Ä–≤–æ–π -->
        <div id="map-container" class="hidden">
          <h3>–ö–∞—Ä—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–∞</h3>
          <!-- map –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω —á–µ—Ä–µ–∑ JavaScript -->
        </div>
        
        <!-- –°–µ–ª–µ–∫—Ç–æ—Ä –º–∞—Ä—à—Ä—É—Ç–æ–≤ - –ø–µ—Ä–µ–º–µ—â–µ–Ω –º–µ–∂–¥—É –∫–∞—Ä—Ç–æ–π –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –º–∞—Ä—à—Ä—É—Ç–µ -->
        <div id="route-selector" class="route-selector-container" style="margin-top: 20px;">
          <label for="route-select" style="display: block; margin-bottom: 8px; font-weight: 500;">–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä—à—Ä—É—Ç:</label>
          <select id="route-select" class="route-select"></select>
        </div>
        
        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–∞—Ä—à—Ä—É—Ç–µ -->
        <div id="route-info" class="hidden" style="margin-top: 30px;">
          <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–∞—Ä—à—Ä—É—Ç–µ</h3>
          <div class="route-info-cards">
            <div class="result-card">
              <div class="result-label">–û–±—â–µ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ</div>
              <div class="result-value" id="distance-value">-</div>
            </div>
            <div class="result-card">
              <div class="result-label">–í—Ä–µ–º—è –≤ –ø—É—Ç–∏</div>
              <div class="result-value" id="duration-value">-</div>
            </div>
            <div class="result-card">
              <div class="result-label">–í—Ä–µ–º—è –Ω–∞ –º–∞—Ä—à—Ä—É—Ç–µ</div>
              <div class="result-value" id="total-route-time-value">-</div>
            </div>
          </div>
        </div>
        
        <!-- –¢–∞–±–ª–∏—Ü–∞ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è -->
        <div id="results-container" class="hidden" style="margin-top: 30px;">
          <h3>–ì–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–¥—Ä–µ—Å–∞</h3>
          <div style="overflow-x: auto;">
            <table class="table">
              <thead>
                <tr>
                  <th>‚Ññ</th>
                  <th>–ú–∞—Ä—à—Ä—É—Ç</th>
                  <th>–ò—Å—Ö–æ–¥–Ω—ã–π –∞–¥—Ä–µ—Å</th>
                  <th>–ù–∞–π–¥–µ–Ω–Ω—ã–π –∞–¥—Ä–µ—Å</th>
                  <th>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã</th>
                  <th>–¢–æ—á–Ω–æ—Å—Ç—å</th>
                </tr>
              </thead>
              <tbody id="geocoder-table"></tbody>
            </table>
          </div>
        </div>
        
        <div class="buttons-container" style="margin-top: 30px; display: flex; gap: 10px;">
          <button type="button" class="btn btn-outline" data-step="1">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
          <button type="button" id="show-summary-btn" class="btn">–†–µ–∑—é–º–µ</button>
        </div>
      </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å —Ä–µ–∑—é–º–µ -->
    <div id="summary-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3>–†–µ–∑—é–º–µ –ø–æ –≤—Å–µ–º –º–∞—Ä—à—Ä—É—Ç–∞–º</h3>
          <button id="close-modal" class="close-button">&times;</button>
        </div>
        <div class="modal-body">
          <!-- –£–¥–∞–ª–µ–Ω–Ω—ã–π –±–ª–æ–∫ -->
          <!-- 
          <div style="margin-bottom: 15px; font-size: 0.9em;">
            <strong>–í—Ä–µ–º—è –Ω–∞ —Ç–æ—á–∫—É (—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ):</strong> <span id="summary-global-service-time">–ù/–î</span> –º–∏–Ω.
          </div>
          -->

          <table class="table" id="summary-table">
            <thead>
              <!-- –ó–∞–≥–æ–ª–æ–≤–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–∑ JS -->
            </thead>
            <tbody>
                <!-- –°—Ç—Ä–æ–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–∑ JS -->
            </tbody>
          </table>
        </div>
        <!-- –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É—Ç–µ—Ä –¥–ª—è –∫–Ω–æ–ø–∫–∏ -->
        <div class="modal-footer">
            <button id="export-summary-btn" class="btn btn-export">–≠–∫—Å–ø–æ—Ä—Ç XLSX</button>
        </div>
      </div>
    </div>
  </div>

  <!-- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
  <script src="/static/js/app.js"></script>
</body>
</html>
